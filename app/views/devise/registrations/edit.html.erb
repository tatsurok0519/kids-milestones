<div class="card">
  <h2 class="h2">アカウント設定</h2>

  <%= render "devise/shared/error_messages", resource: resource %>

  <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
    <div class="field">
      <label class="label" for="user_name">お名前</label>
      <%= f.text_field :name, class: "input", placeholder: "よしえ / ゆきこ など" %>
    </div>

    <div class="field" style="margin-top:.75rem;">
      <label class="label" for="user_email">メールアドレス</label>
      <%= f.email_field :email, autofocus: true, autocomplete: "email", class: "input", placeholder: "you@example.com" %>
    </div>

    <hr class="divider">

    <p style="font-size:.9rem;color:#7b6f69;margin:.25rem 0 .75rem;">
      パスワードを変更しない場合は、以下は空のままでOKです。
    </p>

    <div class="field">
      <label class="label" for="user_password">新しいパスワード</label>
      <%= f.password_field :password, autocomplete: "new-password", class: "input", placeholder: "（変更しない場合は空）" %>
      <% if @minimum_password_length %>
        <small style="color:#7b6f69;">最低 <%= @minimum_password_length %> 文字</small>
      <% end %>
    </div>

    <div class="field" style="margin-top:.75rem;">
      <label class="label" for="user_password_confirmation">新しいパスワード（確認）</label>
      <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "input" %>
    </div>

    <div class="field" style="margin-top:.75rem;">
      <label class="label" for="user_current_password">現在のパスワード</label>
      <%= f.password_field :current_password, autocomplete: "current-password", class: "input", placeholder: "確認のために入力してください" %>
    </div>

    <div class="actions" style="margin-top:1rem;">
      <%= f.submit "更新する", class: "btn btn-primary" %>
      <%= link_to "戻る", (user_signed_in? ? authenticated_root_path : unauthenticated_root_path), class: "btn btn-secondary" %>
    </div>
  <% end %>
</div>

<!-- 退会（アカウント削除） -->
<div class="card" style="margin-top:1rem;">
  <h3 class="h2" style="font-size:1.1rem;margin-top:0;">退会（アカウント削除）</h3>
  <p style="color:#7b6f69;">退会すると、アカウント情報と紐づくデータが削除されます。取り消せません。</p>
  <%= button_to "退会する（取り消し不可）",
        registration_path(resource_name),
        method: :delete,
        data: { turbo_confirm: "本当に退会しますか？この操作は取り消せません。" },
        class: "btn" %>
</div>

<!-- 子どもの管理（編集・削除） -->
<div class="card" style="margin-top:1rem;">
  <h3 class="h2" style="margin-top:0;">お子さまの管理</h3>

  <div class="actions" style="margin:.25rem 0 .75rem; display:flex; gap:.5rem; flex-wrap:wrap;">
    <%= link_to "子どもを追加", new_child_path, class:"btn btn-primary" %>
    <%= link_to "子ども一覧", children_path, class:"btn btn-secondary" %>
  </div>

  <% children =
       if resource.respond_to?(:children)
         resource.children.order(:id)
       else
         Child.where(user_id: resource.id).order(:id) # 保険
       end %>

  <% if children.any? %>
    <div class="cards-grid">
      <% children.each do |child| %>
        <div class="card" style="padding:1rem;">
          <div style="display:flex; gap:.75rem; align-items:center;">
            <% if child.photo.attached? %>
              <%= image_tag child.photo_thumb, alt: "#{child.name}の写真",
                    style: "width:72px;height:72px;object-fit:cover;border-radius:.6rem;border:1px solid var(--border);" %>
            <% else %>
              <%= image_tag "illustrations/sun.png", alt: "", width: 72, height: 72,
                    style: "border-radius:.6rem;border:1px solid var(--border);background:#f3f4f6;" %>
            <% end %>

            <div style="min-width:0;">
              <div style="font-weight:700;"><%= child.name %></div>
              <div class="text-muted" style="font-size:.9rem;margin-top:.2rem;">
                <%= child.age_label %> / <%= child.age_band_label %>
              </div>

              <div style="margin-top:.5rem; display:flex; gap:.5rem; flex-wrap:wrap;">
                <%= link_to "編集",  edit_child_path(child), class:"btn btn-secondary" %>
                <%= link_to "削除",  child_path(child),
                      data:{ turbo_method: :delete, turbo_confirm: "本当に削除しますか？" },
                      class:"btn" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p>登録されたお子さまはまだいません。</p>
  <% end %>
</div>