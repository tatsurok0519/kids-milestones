<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title><%= content_for?(:title) ? yield(:title) : "こどもすくすくカード" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- CSS（Asset Pipeline） -->
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <!-- ★ 重要：Turbo を Sprockets 経由で“確実に”読み込む -->
    <%= javascript_include_tag "turbo.min", defer: true %>
    <%= javascript_include_tag "@hotwired--turbo-rails", defer: true %>

    <!-- ※ importmap は一旦オフにします。後で直します。 -->
    <!-- LAYOUT_MARKER:turbo-sprockets-fallback -->
    <%= preload_link_tag asset_path("illustrations/sun.png"), as: "image" %>
  </head>

  <body class="bg-honey-gradient bg-honey-dots bg-fixed-safe" data-controller="reward-animator">
    <%= render "shared/header" %>
    <%= render("shared/breadcrumbs") if defined?(breadcrumb_trail) && breadcrumb_trail.present? %>
    <%= render("shared/growth_policy_banner") unless content_for?(:hide_growth_banner) %>

    <% flash.each do |k, v| %>
      <div class="container" style="margin-top:1rem">
        <div class="flash <%= k %>"><%= v %></div>
      </div>
    <% end %>

    <main id="main" class="container main" style="padding:1.5rem 0">
      <%= yield %>
    </main>

    <%= render "shared/footer" %>

    <div id="toasts" class="toast-layer" role="status" aria-live="polite" aria-atomic="true">
      <% if @reward_boot_ids.present? %>
        <%= render "shared/reward_toast", rewards: Reward.where(id: @reward_boot_ids) %>
      <% end %>
    </div>

    <div id="reward_animator" hidden aria-hidden="true"></div>

    <%= asset_img "illustrations/watering.png",
          alt: "水やり", width: 110, height: 110,
          class: "watering-illustration" %>
  </body>
</html>