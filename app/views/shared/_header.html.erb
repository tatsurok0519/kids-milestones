<header class="header-bar">
  <div class="container header-inner">
    <!-- 左：ブランド -->
    <div class="brand">
      <%# ← ここで width を clamp で直書き（CSSが遅れても効く） %>
      <%= image_tag "illustrations/sun.png",
            alt: "",
            class: "brand-logo",
            style: "width:clamp(56px,18vw,96px);height:auto;flex:none;" %>

      <h1 class="brand-title">
        <%= link_to "こどもすくすくカード",
                    (respond_to?(:root_path) ? root_path : dashboard_path),
                    style: "text-decoration:none; color:inherit;" %>
      </h1>
    </div>

    <!-- 右：ナビ（現在地は is-active で強調） -->
    <% current_ctrl = controller_path %>
    <% dash_class  = "btn btn-secondary" + (current_ctrl == "dashboard" ? " is-active" : "") %>
    <% tasks_class = "btn btn-secondary" + (current_ctrl == "tasks"     ? " is-active" : "") %>

    <% mypage_url =
         if respond_to?(:mypage_path)
           mypage_path
         elsif respond_to?(:edit_user_registration_path)
           edit_user_registration_path
         elsif respond_to?(:user_path) && defined?(current_user) && current_user
           user_path(current_user)
         end %>
    <% mypg_class = "btn btn-secondary" + (mypage_url && (current_page?(mypage_url) rescue false) ? " is-active" : "") %>

    <nav class="main-nav">
      <%= link_to "ダッシュボード", dashboard_path,             class: dash_class,  "aria-current": (current_ctrl=="dashboard" ? "page" : nil) %>
      <%= link_to "できるかな",    tasks_path(age_band: "all"), class: tasks_class, "aria-current": (current_ctrl=="tasks" ? "page" : nil) %>
      <% if mypage_url %>
        <%= link_to "マイページ",   mypage_url,                  class: mypg_class %>
      <% end %>
      <% if user_signed_in? %>
        <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete }, class: "btn" %>
      <% end %>
    </nav>
  </div>
</header>

<style>
/* 現在地ハイライト */
.btn.is-active { border-color:#60a5fa; background:#eff6ff; }
</style>