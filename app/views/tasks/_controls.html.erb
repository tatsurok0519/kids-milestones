<%# Turbo対応：「がんばり中 / できた！」。この部分は tasks/index 側の
    <turbo-frame id="controls_..."> の中に render されます。 %>

<div>
  <%# 右上バッジ（状態に応じて1つだけ表示） %>
  <% if achievement&.working %>
    <%= image_tag "icons/try.png",
          alt: "", width: 48, height: 48,
          style: "position:absolute; top:8px; right:8px; pointer-events:none;" %>
  <% elsif achievement&.achieved %>
    <%= image_tag "icons/hanamaru.png",
          alt: "", width: 48, height: 48,
          style: "position:absolute; top:8px; right:8px; pointer-events:none;" %>
  <% end %>

  <div style="margin-top:.6rem; display:flex; gap:.5rem; flex-wrap:wrap; align-items:center;">
    <%# がんばり中（テキストのみ / 同フレーム更新） %>
    <%= button_to achievements_upsert_path(milestone_id: milestone.id),
          params: { toggle: "working",  age_band: params[:age_band] },
          method: :post,
          form:   { data: { turbo_frame: dom_id(milestone, :controls) } },
          class:  "btn btn-secondary" do %>
      がんばり中
    <% end %>

    <%# できた！（テキストのみ / 同フレーム更新） %>
    <%= button_to achievements_upsert_path(milestone_id: milestone.id),
          params: { toggle: "achieved", age_band: params[:age_band] },
          method: :post,
          form:   { data: { turbo_frame: dom_id(milestone, :controls) } },
          class:  "btn btn-primary" do %>
      できた！
    <% end %>

    <%# ヒント（押すと展開） %>
    <button type="button" class="btn" style="border:1px dashed var(--border);" data-hint-toggle aria-expanded="false">
      ヒント
    </button>
  </div>

  <%# ヒントパネル（最初は非表示） %>
  <div data-hint-box hidden
       style="margin-top:.5rem; padding:.6rem; border:1px dashed var(--border);
              border-radius:.6rem; background:#fffaf5; color:#7a4a00; font-size:.9rem;">
    <%= milestone.hint_text %>
  </div>
</div>