<% working  = achievement&.working %>
<% achieved = achievement&.achieved %>
<% target_frame_id = (defined?(frame_id) && frame_id.presence) || task_card_frame_id(milestone) %>

<%# ← この部分テンプレート内に <turbo-frame> を置かないこと！ %>

<div style="margin-top:.6rem; display:flex; gap:.5rem; flex-wrap:wrap; align-items:center;">
  <%= button_to achievements_upsert_path(milestone_id: milestone.id,
                                         age_band: params[:age_band], category: params[:category],
                                         difficulty: params[:difficulty],
                                         only_unachieved: params[:only_unachieved], page: params[:page]),
        params: { toggle: "working" }, method: :post,
        form:   { data: { turbo: true, turbo_frame: target_frame_id } },
        class:  "btn btn-secondary #{'is-active' if working}",
        aria:   { pressed: working ? "true" : "false" } do %>
    がんばり中
  <% end %>

  <%= button_to achievements_upsert_path(milestone_id: milestone.id,
                                         age_band: params[:age_band], category: params[:category],
                                         difficulty: params[:difficulty],
                                         only_unachieved: params[:only_unachieved], page: params[:page]),
        params: { toggle: "achieved" }, method: :post,
        form:   { data: { turbo: true, turbo_frame: target_frame_id } },
        class:  "btn btn-primary #{'is-active' if achieved}",
        aria:   { pressed: achieved ? "true" : "false" } do %>
    できた！
  <% end %>
</div>