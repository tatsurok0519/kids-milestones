<div class="container main">
  <% if @children.blank? %>
    <div class="card" style="text-align:center">
      <h2 class="h2">まずはお子さまカードを作成しましょう</h2>
      <p>名前と生年月日を登録すると、年齢やおすすめが表示されます。</p>
      <%= link_to "子どもを追加", new_child_path, class: "btn btn-primary" %>
    </div>
  <% else %>
    <%= render "shared/child_switcher" %>

    <div class="card" style="margin-top:.5rem;">
      <h2 class="h2"><%= @selected_child.name %> さんのカード</h2>

      <!-- 年齢・年齢帯・花丸ピル -->
      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <div class="pill"><%= @selected_child.age_label %></div>
        <div class="pill">対象 <%= @selected_child.age_band_label %></div>
        <div class="pill">花丸 <%= @flower_count %> 個</div>
      </div>

      <hr class="divider">

      <h3 class="h2" style="font-size:1.1rem;">きょうのおすすめ 3 件</h3>
      <% if @recommendations.present? %>
        <div class="cards-grid">
          <% @recommendations.each do |ms| %>
            <div style="border:1px solid var(--border); border-radius:.8rem; padding:.9rem; background:#fff;">
              <div style="font-weight:700;"><%= ms.title %></div>
              <div style="margin-top:.4rem; display:flex; gap:.4rem; align-items:center;">
                <span class="pill"><%= ms.category %></span>
                <span class="pill">★<%= ms.difficulty %></span>
              </div>
              <div style="margin-top:.6rem;">
                <!-- ✅ “その子の年齢帯”をクエリで渡す -->
                <%= link_to "やってみる",
                            tasks_path(age_band: @selected_child.age_band_index),
                            class: "btn btn-secondary" %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p>未達成の項目がありません 🎉</p>
      <% end %>

      <hr class="divider">

      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <!-- ✅ 下の導線も同様に年齢帯を付与 -->
        <%= link_to "できるかなページへ",
                    tasks_path(age_band: @selected_child.age_band_index),
                    class: "btn btn-primary" %>
        <%= link_to "チャットで相談",  "/chat",   class: "btn btn-secondary" %>
        <%= link_to "ふりかえりレポート", "/report", class: "btn btn-secondary" %>
      </div>
    </div>
  <% end %>
</div>