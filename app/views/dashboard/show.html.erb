<div class="container">
  <% if @children.blank? %>
    <div class="card" style="text-align:center">
      <h2 class="h2">まずはお子さまカードを作成しましょう</h2>
      <p>名前と生年月日を登録すると、月齢・週数やおすすめが表示されます。</p>
      <a href="#" class="btn btn-primary" onclick="alert('子ども作成フォームは後日実装予定です');return false;">子どもを追加</a>
    </div>
  <% else %>
    <div class="card" style="overflow:auto; white-space:nowrap;">
      <% @children.each do |kid| %>
        <a href="<%= dashboard_path(child_id: kid.id) %>" style="display:inline-block; margin-right:.75rem; text-decoration:none;">
          <div style="display:flex; align-items:center; gap:.6rem; padding:.5rem .75rem; border:1px solid var(--border); border-radius:.8rem; background:#fff;">
            <% if kid.photo.attached? %>
              <%= image_tag kid.photo, alt: "#{kid.name}の写真", style: "width:48px;height:48px;object-fit:cover;border-radius:50%;" %>
            <% end %>
            <div>
              <div style="font-weight:700;color:var(--text)"><%= kid.name %></div>
              <% if @selected_child&.id == kid.id && @months && @weeks %>
                <div style="font-size:.85rem;color:var(--muted)">月齢 <%= @months %>か月／<%= @weeks %>週</div>
              <% end %>
            </div>
          </div>
        </a>
      <% end %>
    </div>

    <div class="card" style="margin-top:1rem;">
      <h2 class="h2"><%= @selected_child.name %> さんのカード</h2>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <% if @months %><div class="pill">月齢 <%= @months %>か月</div><% end %>
        <% if @weeks %><div class="pill"><%= @weeks %>週</div><% end %>
        <div class="pill">花丸 <%= @flower_count %> 個</div>
      </div>

      <hr class="divider">
      <h3 class="h2" style="font-size:1.1rem;">きょうのおすすめ 3 件</h3>
      <% if @recommendations.present? %>
        <div class="cards-grid">
          <% @recommendations.each do |ms| %>
            <div style="border:1px solid var(--border); border-radius:.8rem; padding:.9rem; background:#fff;">
              <div style="font-weight:700;"><%= ms.title %></div>
              <div style="margin-top:.4rem; display:flex; gap:.4rem; align-items:center;">
                <span class="pill"><%= ms.category %></span>
                <span class="pill">★<%= ms.difficulty %></span>
              </div>
              <div style="margin-top:.6rem;">
                <a href="/tasks" class="btn btn-secondary">やってみる</a>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p>未達成の項目がありません 🎉</p>
      <% end %>

      <hr class="divider">
      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <a href="/tasks"  class="btn btn-primary">できるかなページへ</a>
        <a href="/chat"   class="btn btn-secondary">チャットで相談</a>
        <a href="/report" class="btn btn-secondary">ふりかえりレポート</a>
      </div>
    </div>
  <% end %>
</div>