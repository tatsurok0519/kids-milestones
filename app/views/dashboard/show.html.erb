<div class="container">
  <% if @children.blank? %>
    <div class="card" style="text-align:center">
      <h2 class="h2">まずはお子さまカードを作成しましょう</h2>
      <p>名前とお誕生日を登録すると、月齢・週数や「きょうのおすすめ」が表示されます。</p>
      <%= link_to "子どもを追加", new_child_path, class: "btn btn-primary" %>
    </div>

  <% else %>
    <!-- きょうだいスイッチャー -->
    <div class="card" style="overflow:auto; white-space:nowrap;">
      <% @children.each do |kid| %>
        <%= link_to dashboard_path(child_id: kid.id), style: "display:inline-block; margin-right:.75rem; text-decoration:none;" do %>
          <div style="display:flex; align-items:center; gap:.6rem; padding:.5rem .75rem; border:1px solid var(--border); border-radius:.8rem; background:#fff;">
            <% if kid.photo.attached? %>
              <%= image_tag kid.photo, alt: "#{kid.name}の写真", style: "width:48px;height:48px;object-fit:cover;border-radius:50%;" %>
            <% else %>
              <!-- 写真がないときの丸いプレースホルダー -->
              <div style="width:48px;height:48px;border-radius:50%;background:#fff5e5;display:flex;align-items:center;justify-content:center;font-weight:700;color:#9a6b38;">
                <%= kid.name.to_s.first&.upcase || "?" %>
              </div>
            <% end %>
            <div>
              <div style="font-weight:700;color:var(--text)"><%= kid.name %></div>
              <% if (label = kid.age_label) %>
                <div style="font-size:.85rem;color:var(--muted)"><%= label %></div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>

      <%= link_to "+ 子どもを追加", new_child_path, class: "btn btn-secondary", style: "display:inline-block; margin-left:.5rem;" %>
    </div>

    <% if @selected_child %>
      <!-- 選択中の子どものカード -->
      <div class="card" style="margin-top:1rem;">
        <h2 class="h2"><%= @selected_child.name %> さんのカード</h2>

        <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
          <% if @age_label %><div class="pill"><%= @age_label %></div><% end %>
          <div class="pill">花丸 <%= @flower_count || 0 %> 個</div>
        </div>

        <hr class="divider">

        <h3 class="h2" style="font-size:1.1rem;">きょうのおすすめ 3 件</h3>
        <% if @recommendations.present? %>
          <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:.75rem;">
            <% @recommendations.each do |ms| %>
              <div style="border:1px solid var(--border); border-radius:.8rem; padding:.9rem; background:#fff;">
                <div style="font-weight:700;"><%= ms.title %></div>
                <div style="margin-top:.4rem; display:flex; gap:.4rem; align-items:center;">
                  <span class="pill"><%= ms.category %></span>
                  <span class="pill">★<%= ms.difficulty %></span>
                </div>
                <div style="margin-top:.6rem;">
                  <%= link_to "やってみる", tasks_path, class: "btn btn-secondary" %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p>未達成の項目がありません 🎉</p>
        <% end %>

        <hr class="divider">
        <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
          <%= link_to "できるかなページへ", tasks_path, class: "btn btn-primary" %>
          <%= link_to "チャットで相談", chat_path, class: "btn btn-secondary" %>
          <%= link_to "ふりかえりレポート", report_path, class: "btn btn-secondary" %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>