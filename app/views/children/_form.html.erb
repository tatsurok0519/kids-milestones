<!-- app/views/children/_form.html.erb -->
<%= form_with model: child, local: true, html: { multipart: true } do |f| %>

  <% if child.errors.any? %>
    <div class="flash alert" style="margin-bottom:1rem;">
      <strong><%= child.errors.count %>件のエラーがあります：</strong>
      <ul style="margin:.5rem 0 0 1rem;">
        <% child.errors.full_messages.each do |m| %>
          <li><%= m %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <label class="label" for="child_name">お名前 <span style="color:#c44">*</span></label>
    <%= f.text_field :name, class: "input", placeholder: "例）ゆきこ / よしえ / はると" %>
  </div>

  <div class="field">
    <label class="label" for="child_birthday">お誕生日 <span style="color:#c44">*</span></label>
    <%= f.date_field :birthday, class: "input" %>
  </div>

  <div class="field">
    <label class="label">写真（任意）</label>

    <div style="display:flex; gap:1rem; align-items:center; margin-bottom:.5rem;">
      <%# プレビュー枠（既存があればサムネで表示） %>
      <% if child.photo.attached? %>
        <%= image_tag(child.photo_thumb, alt: "#{child.name}の写真",
              id: "photo-preview",
              style: "width:96px;height:96px;object-fit:cover;border-radius:12px;border:1px solid var(--border);" ) %>
      <% else %>
        <img id="photo-preview" alt="プレビュー"
             style="width:96px;height:96px;object-fit:cover;border-radius:12px;border:1px solid var(--border);background:#f3f4f6;">
      <% end %>

      <div style="display:flex; flex-direction:column; gap:.5rem;">
        <%= f.file_field :photo,
              class: "input",
              accept: "image/png,image/jpg,image/jpeg,image/gif",
              direct_upload: true,
              onchange: "previewSelectedImage(this, 'photo-preview')" %>

        <% if child.photo.attached? %>
          <label class="pill" style="cursor:pointer; user-select:none;">
            <%= f.check_box :remove_photo, {}, "1", "0" %> 写真を削除（新しい写真を選ぶと上書きされます）
          </label>
        <% end %>
      </div>
    </div>

    <small class="text-muted">※ PNG/JPG/GIF、5MBまで。表示時は枠に合わせてトリミングされます。</small>
  </div>

  <div class="actions">
    <%= f.submit (child.persisted? ? "更新する" : "登録する"), class: "btn btn-primary" %>
    <%= link_to "戻る", children_path, class: "btn btn-secondary" %>
  </div>
<% end %>