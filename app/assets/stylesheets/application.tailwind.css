/* ===== sunny, warm UI theme (plain CSS) ===== */
:root{
  /* やわらかいクリーム × サニーオレンジ × はちみつ色 */
  --bg:#fff7e6;          /* クリーム背景 */
  --surface:#ffffff;
  --text:#3b2a18;        /* こげ茶で読みやすく */
  --muted:#7a6b5a;
  --border:#f2e5c6;

  --pri:#f29f05;         /* 主ボタン：オレンジ */
  --pri-600:#e88f00;
  --pri-700:#d07c00;

  --accent:#ffd369;      /* フォーカスや強調に使う“はちみつ色” */
  --accent-600:#f0c24d;

  /* 成功/エラー：やさしめの色味 */
  --ok-bg:#f2f8e9;  --ok-text:#3f6b2a;  --ok-border:#d6ebc0;
  --err-bg:#fff1ec; --err-text:#9b2c10; --err-border:#f7c4b3;

  --radius-lg: 1rem;
  --shadow-sm: 0 1px 2px rgba(0,0,0,.06);
  --shadow-md: 0 10px 20px rgba(240,160,60,.12);
}

/* ベース */
html{scroll-behavior:smooth}
body{
  min-height:100vh;
  background:linear-gradient(180deg,#fffbed 0%, var(--bg) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  font-family:"Hiragino Kaku Gothic ProN","Yu Gothic","游ゴシック体",Meiryo,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
}
a{color:#c17400;text-underline-offset:2px}
a:hover{color:#9f5f00;text-decoration:underline}

/* レイアウト */
.container{max-width:64rem;margin:0 auto;padding:0 1rem}
.header-bar{
  background:linear-gradient(180deg,#fffaf0 0%, #ffe7b8 100%);
  border-bottom:1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.header-inner{
  display:flex;align-items:center;justify-content:space-between;gap:.5rem;
  padding:.85rem 0
}

/* セクション & カード */
.h2{font-size:1.25rem;font-weight:700;margin:.25rem 0 .75rem}
.card{
  background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-lg);
  box-shadow:var(--shadow-md); padding:1.5rem;
}

/* ボタン */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:.35rem;
  padding:.55rem 1rem;font-size:.9rem;font-weight:700;border-radius:.7rem;
  border:1px solid transparent;text-decoration:none;transition:.15s;cursor:pointer;
  box-shadow:0 1px 1px rgba(0,0,0,.04);
}
.btn:focus{outline:none; box-shadow:0 0 0 3px rgba(255,211,105,.35)} /* はちみつ色のフォーカス */
.btn-primary{background:var(--pri);color:#fff}
.btn-primary:hover{background:var(--pri-600)}
.btn-secondary{background:#fff;color:var(--text);border-color:var(--border)}
.btn-secondary:hover{background:#fff8e0}

/* フォーム */
.label{display:block;font-size:.9rem;font-weight:700;color:#6a5a48;margin-bottom:.35rem}
.input,
input[type="text"],input[type="email"],input[type="password"],input[type="search"],
input[type="url"],input[type="number"],input[type="date"],textarea,select{
  width:100%;background:#fff;color:#2a2523;border:1px solid var(--border);border-radius:.7rem;
  padding:.6rem .8rem;font-size:.95rem;outline:none;transition:.15s;
}
.input:focus,input:focus,textarea:focus,select:focus{
  border-color:var(--accent-600); box-shadow:0 0 0 3px rgba(255,211,105,.35);
}
.field_with_errors input,.field_with_errors textarea,.field_with_errors select{
  border-color:#f19999; box-shadow:0 0 0 3px rgba(241,153,153,.25)
}

/* ピル/タグ */
.pill{
  display:inline-flex;align-items:center;gap:.35rem;
  padding:.25rem .6rem;border-radius:999px;font-size:.75rem;font-weight:700;
  background:#fff;border:1px solid var(--border);color:#6b5d54;
}

/* フラッシュ */
.flash{border-radius:.9rem;padding:.8rem 1rem;border:1px solid transparent}
.flash.notice{background:var(--ok-bg);color:var(--ok-text);border-color:var(--ok-border)}
.flash.alert {background:var(--err-bg);color:var(--err-text);border-color:var(--err-border)}

/* 小物 */
.divider{height:1px;background:var(--border);border:0;margin:1rem 0}
.footer{color:var(--muted);font-size:.85rem;padding:1.25rem 0}

/* ==== フォームはみ出し対策 ==== */
*, *::before, *::after { box-sizing: border-box; }
.input,
input[type="text"], input[type="email"], input[type="password"],
input[type="search"], input[type="url"], input[type="number"], input[type="date"],
input:not([type]), textarea, select {
  width:100%; max-width:100%; box-sizing:border-box;
}
.card { overflow:hidden; }
.card .field { margin-top:.75rem; }
.card .actions { margin-top:1rem; }

/* === 装飾イラスト === */
/* タイトル横などで使う小さめ太陽（1定義に統一） */
.sun-inline{
  width:64px;height:auto;
  transform: rotate(-8deg);
  filter: drop-shadow(0 3px 4px rgba(255,170,0,.25));
  vertical-align: middle;
  opacity:.9;
}
@media (max-width: 640px){
  .sun-inline{ width:48px; }
}

/* 小さな人物イラスト（お日さまサイズに合わせる） */
.kid-inline{
  width:64px; height:auto; vertical-align:middle;
}
@media (max-width: 640px){
  .kid-inline{ width:48px; }
}

/* できるかな見出し用の小さな子どもアイコン */
.title-with-ico { display:flex; align-items:center; gap:.5rem; }

.kids-inline {
  width: 56px;          /* お日さま程度のサイズ */
  height: auto;
  flex: none;
  vertical-align: middle;
  transform: none;      /* 傾けない */
  filter: drop-shadow(0 3px 4px rgba(255,170,0,.25));
}
@media (max-width: 640px){
  .kids-inline { width: 44px; }   /* スマホは少し小さく */
}

/* ======== Mobile-first polish ======== */

/* タップしやすさ（ボタン/入力の最小高さ） */
.btn,
input[type="text"], input[type="email"], input[type="password"],
input[type="search"], input[type="url"], input[type="number"], input[type="date"],
input:not([type]), textarea, select {
  min-height: 44px;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

/* 画像は親幅にフィット */
img { max-width: 100%; height: auto; }

/* 共通カードグリッド用 */
.cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: .75rem; }

/* 余白と文字サイズを小さめ画面で調整 */
@media (max-width: 640px) {
  .container { padding: 0 1rem; }
  .card { padding: 1rem; }
  .h1 { font-size: 1rem; text-align: center; }
  .h2 { font-size: 1.1rem; }

  /* ヘッダーは縦積み */
  .header-inner { flex-direction: column; align-items: stretch; }
}

/* とても狭い幅では太陽を隠す（被り防止） */
@media (max-width: 360px) {
  .sun-inline{ display: none; }
}

/* ===== 子ども切替UI ===== */
.kid-scroll{
  overflow:auto; white-space:nowrap; padding-bottom:.25rem;
  display:flex; gap:.5rem;
}
.kid-chip{
  display:inline-flex; align-items:center; gap:.6rem;
  background:#fff; border:1px solid var(--border);
  padding:.5rem .7rem; border-radius:.9rem; text-decoration:none; color:#fff0;
  color:var(--text);
  box-shadow: var(--shadow-sm);
}
.kid-chip:hover{ background:#fff8e0; }
.kid-chip--active{
  border-color: var(--accent-600);
  box-shadow: 0 0 0 3px rgba(255,211,105,.25);
  background: #fffdf4;
}
.kid-avatar-fallback{
  width:40px; height:40px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  background:#fff3d1; color:#9a7b35; font-weight:700;
  border:1px solid var(--border);
}
.kid-meta .kid-name{ font-weight:700; line-height:1.1; }
.kid-meta .kid-age{ font-size:.8rem; color:#7a6b5a; }

/* 表示切替（PC/スマホ） */
.only-mobile{ display:none; }
@media (max-width: 640px){
  .only-desktop{ display:none; }
  .only-mobile{ display:block; }
}

.kid-chip.is-active {
  outline: 3px solid rgba(255,211,105,.35);
  border-color: var(--pri-600);
}

/* 画面幅で出し分け（PCは横スクロール、スマホはドロップダウン） */
@media (min-width: 641px) { .child-switcher .dropdown-sm { display: none; } }
@media (max-width: 640px) { .child-switcher .row { display: none; } }

/* ---- rewards (控えめ演出) ---- */
@layer components {
  .reward-icon,
  .reward-icon img {
    transition: transform .35s ease, filter .35s ease, opacity .35s ease;
    will-change: transform, filter, opacity;
  }
  .reward-icon.anim-unlock,
  .reward-icon.anim-unlock img {
    animation: rw-pop .45s cubic-bezier(.2,.8,.2,1),
               rw-glow 1.4s ease-out .15s both;
    will-change: transform, filter, opacity;
  }
}
@keyframes rw-pop { 0%{transform:scale(.6) rotate(-4deg);opacity:0} 60%{transform:scale(1.10);opacity:1} 100%{transform:scale(1)} }
@keyframes rw-glow{ 0%{filter:drop-shadow(0 0 0 rgba(255,200,0,0))} 100%{filter:drop-shadow(0 0 12px rgba(255,200,0,.45))} }

@media (prefers-reduced-motion: reduce) {
  .reward-icon, .reward-icon img { transition: none !important; }
  .reward-icon.anim-unlock, .reward-icon.anim-unlock img { animation: none !important; }
}

/* ---- toast (唯一の定義) ---- */
@layer components {
  /* 受け皿（右上固定） */
  .toast-layer,
  #toasts, .toasts {              /* 互換のためエイリアスも許容 */
    position: fixed;
    top: 1rem;                    /* 右上に出す */
    right: 1rem;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: .5rem;
    pointer-events: none;         /* 背景にクリックを透過 */
  }

  /* 本体 */
  .toast {
    pointer-events: auto;         /* トースト自体はクリック可 */
    display: flex;
    align-items: center;
    gap: .5rem;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: .6rem;
    padding: .5rem .7rem;
    box-shadow: 0 6px 20px rgba(0,0,0,.06);
    animation: toast-in .25s ease-out;
    transition: opacity .28s, transform .28s;
  }

  /* 自動消去時のフェード用（_reward_toast で付与） */
  .reward-toast.is-leaving { opacity: 0; transform: translateY(6px); }
}
@keyframes toast-in { from { transform: translateY(-6px); opacity:0; } to { opacity:1; } }

/* どのテーマでもリンクが見やすいように */
.link { color:#c17400; text-underline-offset:2px; }
.link:hover { color:#9f5f00; text-decoration: underline; }

/* ---- Header layout ---- */
.header-inner{ display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; padding:.85rem 0; }
.brand{ display:flex; align-items:center; gap:.6rem; min-width:0; }
.brand-title{ font-size:1.6rem; line-height:1.15; margin:0; }
@media (max-width:640px){ .brand-title{ font-size:1.35rem; } }

/* ナビ（ボタン群） */
.main-nav{ display:flex; gap:.5rem; flex-wrap:wrap; }
/* モバイル：2段目へ・全幅 */
@media (max-width:640px){
  .brand{ flex: 1 1 100%; }
  .main-nav{ flex: 1 1 100%; order:2; justify-content:flex-start; }
}
/* PC：右寄せ */
@media (min-width:641px){
  .main-nav{ margin-left:auto; justify-content:flex-end; }
}

/* ========= A11y base ========= */
.sr-only {
  position:absolute !important; width:1px; height:1px; padding:0; margin:-1px;
  overflow:hidden; clip:rect(0,0,1px,1px); white-space:nowrap; border:0;
}

:focus { outline: none; }
:focus-visible {
  outline: 3px solid rgba(255,211,105,.85);
  outline-offset: 2px;
  border-radius: .4rem;
}

/* タップ領域の最低サイズ（44x44） */
a.btn, button.btn, .pill,
input[type="checkbox"] + label, input[type="radio"] + label {
  min-height: 44px;
  min-width: 44px;
  display: inline-flex; align-items: center; justify-content: center;
}

/* チェック系 */
input[type="checkbox"], input[type="radio"] { inline-size: 1.1rem; block-size: 1.1rem; }
.form-check { display:flex; align-items:center; gap:.5rem; }
.form-check > input { flex: none; }
.form-check > label { cursor: pointer; }

/* 入力欄のコントラスト/エラー伝達 */
input, textarea, select { color: #2a2523; background:#fff; border:1px solid var(--border); }
input[aria-invalid="true"], textarea[aria-invalid="true"], select[aria-invalid="true"]{
  border-color:#e35b5b; box-shadow:0 0 0 3px rgba(227,91,91,.15);
}

/* セカンダリボタン見やすく */
.btn-secondary { color:#222; background:#fff; border-color:#ddd; }
.btn-secondary:hover { background:#fff8e0; border-color:#ccc; }

/* （残しておくなら）高コントラスト・モード */
html[data-contrast="high"] {
  --text:#1b1b1b; --border:#c9b890;
  --pri:#cf7f00; --pri-600:#b86f00; --accent:#ffca3a;
}
html[data-contrast="high"] body { color: var(--text); }
html[data-contrast="high"] .btn-primary { background: var(--pri); }
html[data-contrast="high"] .btn-secondary { border-color: #bbb; color:#161616; }

/* === Hard cap: header sun logo (never giant again) === */
/* ※必ずファイルの最後に置いてください */
header.header-bar img.brand-logo{
  width:72px !important;
  max-width:72px !important;
  height:auto !important;
  flex:none;
}
@media (min-width: 641px){
  header.header-bar img.brand-logo{ width:88px !important; max-width:88px !important; }
}
@media (min-width: 1024px){
  header.header-bar img.brand-logo{ width:104px !important; max-width:104px !important; }
}

/* --- ヒントを確実に表示（hint / hint-wrap の両方に適用） --- */
details.hint,
details.hint-wrap {
  display: block;
}

details.hint > summary,
details.hint-wrap > summary,
summary.btn-hint {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  /* 他のCSSが display:none を指定していても勝つための保険 */
}

/* ブラウザ既定の三角を消す（任意） */
details.hint > summary::-webkit-details-marker,
details.hint-wrap > summary::-webkit-details-marker,
summary.btn-hint::-webkit-details-marker {
  display: none;
}

/* ======== Mobile-first additions ======== */

/* --- カード・グリッドの最小幅をスマホ寄りに（つめすぎ防止） --- */
.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* 220px -> 180px */
  gap: .75rem;
}
@media (min-width: 641px){
  .cards-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
}

/* --- カードの内側余白を縮める（スマホ） --- */
@media (max-width: 640px){
  .card { padding: 1rem; }
}

/* --- 見出し／本文の微調整（スマホ） --- */
@media (max-width: 640px){
  .h2 { font-size: 1.05rem; }
}

/* --- ハンバーガー（モバイルナビ） --- */
.nav-toggle {
  display: none;
  align-items: center; justify-content: center;
  width: 44px; height: 44px; border-radius: .6rem;
  background: #fff; border: 1px solid var(--border);
}
@media (max-width: 640px){
  .nav-toggle { display: inline-flex; }
  .main-nav { display: none; width: 100%; }
  .main-nav[data-open="true"] {
    display: flex;
    flex-direction: column;
    gap: .5rem;
    padding-top: .5rem;
  }
  /* ナビ開時に背景スクロールを止める */
  body.nav-open { overflow: hidden; }
}

/* --- 汎用モーダル（PC:中央／SP:ボトムシート） --- */
.modal-backdrop {
  position: fixed; inset: 0; background: rgba(0,0,0,.35);
  display: none; z-index: 1000;
}
.modal-backdrop[data-open="true"] { display: block; }

.modal-panel {
  position: fixed; left: 50%; top: 50%;
  transform: translate(-50%, -50%);
  width: min(92vw, 720px); max-height: 86vh; overflow: auto;
  background: #fff; border: 1px solid var(--border);
  border-radius: var(--radius-lg); box-shadow: var(--shadow-md);
  padding: 1rem; z-index: 1001;
}
@media (max-width: 640px){
  .modal-panel {
    left: 0; right: 0; bottom: 0; top: auto;
    transform: none;
    width: 100%; max-height: 88vh; border-radius: 1rem 1rem 0 0;
  }
}

/* モーダルの閉じるボタン（右上×） */
.modal-close {
  position: absolute; right: .5rem; top: .5rem;
  width: 40px; height: 40px; border-radius: .6rem;
  background: #fff; border: 1px solid var(--border);
  display: inline-flex; align-items: center; justify-content: center;
}

/* 非クリティカル画像は遅延（念のための共通クラス） */
img.lazy { content-visibility: auto; }

/* モバイル開閉ボタンを隠す＋ナビは常時表示 */
#mobile-nav-btn,
.nav-toggle { display: none !important; }

#mobile-nav-panel,
[data-nav] { display: flex !important; gap: .5rem; flex-wrap: wrap; }

/* 「できるかな」のトグル用（色を明示） */
.btn-secondary.is-active{
  background:#fffdf4;
  border-color: var(--accent-600);
}
.btn-primary.is-active{
  background: var(--pri-600);
  color:#fff;
  border-color: transparent;
}

/* ==== Print (A4) ==== */
@page { size: A4; margin: 14mm; }

@media print {
  /* ヘッダーは必ず印刷する（見た目は簡素に） */
  header.header-bar {
    display: block !important;
    visibility: visible !important;
    position: static !important;      /* sticky/fixed 無効化 */
    background: #fff !important;
    box-shadow: none !important;
    border: 0 !important;
    padding: 8pt 0 !important;
  }
  header.header-bar .brand-logo {
    width: 48pt !important;
    height: auto !important;
  }
  header.header-bar .brand-title {
    font-size: 16pt !important;
    margin: 0 !important;
  }

  /* ナビは印刷では要らない */
  header.header-bar .main-nav { display: none !important; }

  /* 画面専用は非表示。no-print はそのまま非表示（ヘッダーに付いていても上で強制表示） */
  .only-screen { display: none !important; }
  .no-print    { display: none !important; }
  header.header-bar.no-print { display: block !important; } /* もし class="no-print" が付いていても出す */

  /* 紙向けに少しだけ整える */
  .card { box-shadow: none !important; border: 1px solid #ddd !important; }
  a { color:#000 !important; text-decoration: none !important; }
}

/* 水やりは画面右下に固定（クリック邪魔しない） */
.watering-illustration{
  position: fixed;
  right: 20px;
  bottom: 20px;
  width: 110px;
  z-index: 0;
  opacity: .9;
  filter: drop-shadow(0 6px 12px rgba(240,160,60,.15));
  pointer-events: none;           /* ← これで下のリンクが押せる */
}

/* フッター（右側に余白を確保してイラストと重ならないように） */
.footer{
  color: var(--muted);
  font-size: .85rem;
  padding: 1.25rem 0;
  padding-right: 140px;           /* ← 右にスペースを作ってリンクを左へ */
}

/* 小さい画面では少し縮める */
@media (max-width: 640px){
  .watering-illustration{ width: 88px; right: 12px; bottom: 12px; }
  .footer{ padding-right: 100px; }
}

@keyframes rewardGlow {
  0%   { transform: scale(1);   filter: drop-shadow(0 0 0px #ffd54f); }
  50%  { transform: scale(1.18); filter: drop-shadow(0 0 16px #ffd54f); }
  100% { transform: scale(1);   filter: drop-shadow(0 0 0px #ffd54f); }
}
.reward-glow { animation: rewardGlow 1200ms ease-out 1; }
@media (prefers-reduced-motion: reduce) { .reward-glow { animation: none; } }

@layer utilities {
  /* 1) ふんわり蜂蜜グラデ（ボディ向け） */
  .bg-honey-gradient {
    background: linear-gradient(180deg, #FFF7E0 0%, #FFFDF5 55%, #FFFFFF 100%);
  }

  /* 2) うっすらドット（重ね掛け用・パフォーマンス軽い） */
  .bg-honey-dots {
    background-image:
      radial-gradient(rgba(255, 200, 60, .16) 1.5px, transparent 2px);
    background-size: 24px 24px;
  }

  /* 3) ヒーローヘッダー：下端が波の帯（ヘッダー用） */
  .hero-honey-wave {
    position: relative;
    background: linear-gradient(180deg, #FFF4C2 0%, #FFEAA0 100%);
    isolation: isolate;            /* 子要素の重なりを安定化 */
  }
  .hero-honey-wave::after {
    content: "";
    position: absolute;
    left: 0; right: 0; bottom: -1px; height: 48px;
    background-repeat: repeat-x;
    background-size: 1200px 48px;
    /* 白い波（SVGをインライン） */
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 48' preserveAspectRatio='none'><path fill='%23FFFFFF' d='M0,24 C150,0 300,48 450,24 C600,0 750,48 900,24 C1050,0 1200,48 1200,48 L0,48 Z'/></svg>");
    pointer-events: none;
  }

  /* 4) モバイルの横スク時に背景が切れないように */
  .bg-fixed-safe {
    background-attachment: scroll; /* iOSでのパフォーマンス優先 */
  }

  /* 5) 印刷は真っ白に（既存の @media print 方針と整合） */
  @media print {
    .bg-honey-gradient, .bg-honey-dots, .hero-honey-wave { background: #fff !important; }
    .hero-honey-wave::after { display: none !important; }
  }
}